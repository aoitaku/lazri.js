(function(w,T){typeof exports=="object"&&typeof module<"u"?T(exports):typeof define=="function"&&define.amd?define(["exports"],T):(w=typeof globalThis<"u"?globalThis:w||self,T(w.Lazri={}))})(this,function(w){"use strict";function T(f){return f.map(u=>{switch(u.type){case"section":return Be(u.content);case"blankline":return"";case"title":return Pe(u.content);case"heading":return je(u.content);case"subheading":return Re(u.content);case"indented":return Te(u.content);case"align-right":return ke(u.content);case"ruler":return"<hr>"}}).join(`
`)}function Pe(f){return`<h1>${f}</h1>`}function je(f){return`<h2>${f}</h2>`}function Re(f){return`<h3>${f}</h3>`}function Be(f){return`<div class="section">${f.filter(({type:u})=>u==="paragraph").map(({content:u})=>Se(u)).join(`
`)}</div>`}function Se(f){return`<p>${f.filter(({type:u})=>u==="sentence").map(({content:u})=>U(u)).join(`<br>
`)}</p>`}function Te(f){return`<div class="indented section"><p>${f.filter(u=>u.type==="sentence").map(({content:u})=>U(u)).join(`<br>
`)}</p></div>`}function ke(f){return`<div data-align="right"><p>${f.filter(u=>u.type==="sentence").map(({content:u})=>U(u)).join(`<br>
`)}</p></div>`}function U(f){return f.map(({type:u,content:r})=>{switch(u){case"text":return r;case"bouten":return He(r);case"rubi":return De(r);case"cite":return Ie(r)}}).join("")}function He(f){return`<em class="bouten">${f}</em>`}function Ie(f){return`<cite>${f}</cite>`}function De(f){const{base:u,rubi:r}=f;return`<ruby>${u}<rp>\uFF08</rp><rt>${r}</rt><rp>\uFF09</rp></ruby>`}function Oe(f,u){function r(){this.constructor=f}r.prototype=u.prototype,f.prototype=new r}function B(f,u,r,$){var g=Error.call(this,f);return Object.setPrototypeOf&&Object.setPrototypeOf(g,B.prototype),g.expected=u,g.found=r,g.location=$,g.name="SyntaxError",g}Oe(B,Error);function X(f,u,r){return r=r||" ",f.length>u?f:(u-=f.length,r+=r.repeat(u),f+r.slice(0,u))}B.prototype.format=function(f){var u="Error: "+this.message;if(this.location){var r=null,$;for($=0;$<f.length;$++)if(f[$].source===this.location.source){r=f[$].text.split(/\r\n|\n|\r/g);break}var g=this.location.start,A=this.location.source+":"+g.line+":"+g.column;if(r){var C=this.location.end,E=X("",g.line.toString().length," "),F=r[g.line-1],p=g.line===C.line?C.column:F.length+1,o=p-g.column||1;u+=`
 --> `+A+`
`+E+` |
`+g.line+" | "+F+`
`+E+" | "+X("",g.column-1," ")+X("",o,"^")}else u+=`
 at `+A}return u},B.buildMessage=function(f,u){var r={literal:function(p){return'"'+g(p.text)+'"'},class:function(p){var o=p.parts.map(function(d){return Array.isArray(d)?A(d[0])+"-"+A(d[1]):A(d)});return"["+(p.inverted?"^":"")+o.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(p){return p.description}};function $(p){return p.charCodeAt(0).toString(16).toUpperCase()}function g(p){return p.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(o){return"\\x0"+$(o)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(o){return"\\x"+$(o)})}function A(p){return p.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(o){return"\\x0"+$(o)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(o){return"\\x"+$(o)})}function C(p){return r[p.type](p)}function E(p){var o=p.map(C),d,P;if(o.sort(),o.length>0){for(d=1,P=1;d<o.length;d++)o[d-1]!==o[d]&&(o[P]=o[d],P++);o.length=P}switch(o.length){case 1:return o[0];case 2:return o[0]+" or "+o[1];default:return o.slice(0,-1).join(", ")+", or "+o[o.length-1]}}function F(p){return p?'"'+g(p)+'"':"end of input"}return"Expected "+E(f)+" but "+F(u)+" found."};function Le(f,u){u=u!==void 0?u:{};var r={},$=u.grammarSource,g={Doc:$e},A=$e,C="***",E="======",F="====",p="==",o="=",d="        ",P="                ",V="    ",W="``",Y='""',Z="^",ee="(",re=")",Ne="\\",ne=`\r
`,se=/^[ ]/,H=/^[^\r\n]/,ie=/^[^)\r\n]/,te=/^[^(\r\n]/,_e=/^[\\"`\^()%\-]/,ze=/^[\r\n]/,Ue=/^[ \t]/,Xe=v("***",!1),qe=v("======",!1),Ge=v("====",!1),fe=v("==",!1),q=yr(),ae=v("=",!1),Je=v("        ",!1),Ke=v("                ",!1),le=j([" "],!1,!1),Qe=v("    ",!1),Ve=v("``",!1),I=j(["\r",`
`],!0,!1),We=v('""',!1),ue=v("^",!1),ce=v("(",!1),oe=v(")",!1),pe=j([")","\r",`
`],!0,!1),ge=j(["(","\r",`
`],!0,!1),Ye=j(["\\",'"',"`","^","(",")","%","-"],!1,!1),Ze=v("\\",!1),er=v(`\r
`,!1),rr=j(["\r",`
`],!1,!1),nr=j([" ","	"],!1,!1),sr=function(){return{type:"blankline"}},ir=function(){return{type:"ruler"}},tr=function(e){return{type:"title",content:e}},fr=function(e){return{type:"heading",content:e}},ar=function(e){return{type:"subheading",content:e}},lr=function(e){return{type:"text",content:e}},ur=function(e){return{type:"indented",content:e}},cr=function(e){return{type:"align-right",content:e}},or=function(e){return{type:"section",content:e}},pr=function(e){return{type:"paragraph",content:e}},gr=function(e){return{type:"sentence",content:e}},vr=function(e){return e.join("")},hr=function(e){return{type:"bouten",content:e}},$r=function(e){return e.join("")},dr=function(e){return{type:"cite",content:e}},br=function(e){return e.join("")},mr=function(e){return e.join("")},Ar=function(e,s){return{type:"rubi",content:{base:e,rubi:s}}},xr=function(e){return{type:"text",content:e.join("")}},i=0,D=[{line:1,column:1}],b=0,G=[],l=0,O;if("startRule"in u){if(!(u.startRule in g))throw new Error(`Can't start parsing from rule "`+u.startRule+'".');A=g[u.startRule]}function v(e,s){return{type:"literal",text:e,ignoreCase:s}}function j(e,s,n){return{type:"class",parts:e,inverted:s,ignoreCase:n}}function yr(){return{type:"any"}}function wr(){return{type:"end"}}function ve(e){var s=D[e],n;if(s)return s;for(n=e-1;!D[n];)n--;for(s=D[n],s={line:s.line,column:s.column};n<e;)f.charCodeAt(n)===10?(s.line++,s.column=1):s.column++,n++;return D[e]=s,s}function he(e,s){var n=ve(e),t=ve(s);return{source:$,start:{offset:e,line:n.line,column:n.column},end:{offset:s,line:t.line,column:t.column}}}function c(e){i<b||(i>b&&(b=i,G=[]),G.push(e))}function Cr(e,s,n){return new B(B.buildMessage(e,s),e,s,n)}function $e(){var e,s;for(e=[],s=de();s!==r;)e.push(s),s=de();return e}function de(){var e;return e=k(),e===r&&(e=be(),e===r&&(e=Lr())),e}function k(){var e,s,n;if(e=i,s=[],n=h(),n!==r)for(;n!==r;)s.push(n),n=h();else s=r;return s!==r&&(s=sr()),e=s,e}function be(){var e;return e=Er(),e===r&&(e=Fr(),e===r&&(e=Dr(),e===r&&(e=Hr()))),e}function Er(){var e,s,n,t;return e=i,s=i,l++,n=h(),l--,n===r?s=void 0:(i=s,s=r),s!==r?(f.substr(i,3)===C?(n=C,i+=3):(n=r,l===0&&c(Xe)),n!==r?(t=z(),t!==r?e=ir():(i=e,e=r)):(i=e,e=r)):(i=e,e=r),e}function Fr(){var e;return e=jr(),e===r&&(e=Br(),e===r&&(e=Tr())),e}function Pr(){var e,s,n,t,a;if(e=i,s=i,l++,n=h(),l--,n===r?s=void 0:(i=s,s=r),s!==r)if(f.substr(i,6)===E?(n=E,i+=6):(n=r,l===0&&c(qe)),n!==r){if(t=[],a=y(),a!==r)for(;a!==r;)t.push(a),a=y();else t=r;t!==r?(s=[s,n,t],e=s):(i=e,e=r)}else i=e,e=r;else i=e,e=r;return e}function jr(){var e,s,n,t;return e=i,s=Pr(),s!==r?(n=J(),n!==r?(t=K(),t!==r?e=tr(n):(i=e,e=r)):(i=e,e=r)):(i=e,e=r),e}function Rr(){var e,s,n,t,a;if(e=i,s=i,l++,n=h(),l--,n===r?s=void 0:(i=s,s=r),s!==r)if(f.substr(i,4)===F?(n=F,i+=4):(n=r,l===0&&c(Ge)),n!==r){if(t=[],a=y(),a!==r)for(;a!==r;)t.push(a),a=y();else t=r;t!==r?(s=[s,n,t],e=s):(i=e,e=r)}else i=e,e=r;else i=e,e=r;return e}function Br(){var e,s,n,t;return e=i,s=Rr(),s!==r?(n=J(),n!==r?(t=K(),t!==r?e=fr(n):(i=e,e=r)):(i=e,e=r)):(i=e,e=r),e}function Sr(){var e,s,n,t,a;if(e=i,s=i,l++,n=h(),l--,n===r?s=void 0:(i=s,s=r),s!==r)if(f.substr(i,2)===p?(n=p,i+=2):(n=r,l===0&&c(fe)),n!==r){if(t=[],a=y(),a!==r)for(;a!==r;)t.push(a),a=y();else t=r;t!==r?(s=[s,n,t],e=s):(i=e,e=r)}else i=e,e=r;else i=e,e=r;return e}function Tr(){var e,s,n,t;return e=i,s=Sr(),s!==r?(n=J(),n!==r?(t=K(),t!==r?e=ar(n):(i=e,e=r)):(i=e,e=r)):(i=e,e=r),e}function J(){var e,s;if(e=[],s=me(),s!==r)for(;s!==r;)e.push(s),s=me();else e=r;return e}function me(){var e;return e=M(),e===r&&(e=kr()),e}function kr(){var e,s,n,t;if(e=i,s=i,n=[],t=Ae(),t!==r)for(;t!==r;)n.push(t),t=Ae();else n=r;return n!==r?s=f.substring(s,i):s=n,s!==r&&(s=lr(s)),e=s,e}function Ae(){var e,s,n;return e=i,s=i,l++,n=M(),n===r&&(n=xe(),n===r&&(n=h())),l--,n===r?s=void 0:(i=s,s=r),s!==r?(f.length>i?(n=f.charAt(i),i++):(n=r,l===0&&c(q)),n!==r?(s=[s,n],e=s):(i=e,e=r)):(i=e,e=r),e}function K(){var e;return e=xe(),e===r&&(e=z()),e}function xe(){var e,s,n,t,a,x,Q,S;if(e=i,s=i,l++,n=h(),l--,n===r?s=void 0:(i=s,s=r),s!==r){if(n=[],t=y(),t!==r)for(;t!==r;)n.push(t),t=y();else n=r;if(n!==r){if(t=i,a=i,f.substr(i,2)===p?(x=p,i+=2):(x=r,l===0&&c(fe)),x!==r){for(Q=[],f.charCodeAt(i)===61?(S=o,i++):(S=r,l===0&&c(ae));S!==r;)Q.push(S),f.charCodeAt(i)===61?(S=o,i++):(S=r,l===0&&c(ae));x=[x,Q],a=x}else i=a,a=r;a!==r?t=f.substring(t,i):t=a,t!==r?(a=z(),a!==r?(s=[s,n,t,a],e=s):(i=e,e=r)):(i=e,e=r)}else i=e,e=r}else i=e,e=r;return e}function Hr(){var e,s,n;if(e=i,s=[],n=ye(),n===r&&(n=k()),n!==r)for(;n!==r;)s.push(n),n=ye(),n===r&&(n=k());else s=r;return s!==r&&(s=ur(s)),e=s,e}function Ir(){var e,s,n;return e=i,s=i,l++,n=h(),l--,n===r?s=void 0:(i=s,s=r),s!==r?(f.substr(i,8)===d?(n=d,i+=8):(n=r,l===0&&c(Je)),n!==r?(s=[s,n],e=s):(i=e,e=r)):(i=e,e=r),e}function ye(){var e,s,n;return e=i,s=Ir(),s!==r?(n=L(),n!==r?e=n:(i=e,e=r)):(i=e,e=r),e}function Dr(){var e,s,n;if(e=i,s=[],n=we(),n===r&&(n=k()),n!==r)for(;n!==r;)s.push(n),n=we(),n===r&&(n=k());else s=r;return s!==r&&(s=cr(s)),e=s,e}function Or(){var e,s,n,t,a;if(e=i,s=i,l++,n=h(),l--,n===r?s=void 0:(i=s,s=r),s!==r)if(f.substr(i,16)===P?(n=P,i+=16):(n=r,l===0&&c(Ke)),n!==r){for(t=[],se.test(f.charAt(i))?(a=f.charAt(i),i++):(a=r,l===0&&c(le));a!==r;)t.push(a),se.test(f.charAt(i))?(a=f.charAt(i),i++):(a=r,l===0&&c(le));s=[s,n,t],e=s}else i=e,e=r;else i=e,e=r;return e}function we(){var e,s,n;return e=i,s=Or(),s!==r?(n=L(),n!==r?e=n:(i=e,e=r)):(i=e,e=r),e}function Lr(){var e,s,n,t;if(e=i,s=[],n=i,t=Ce(),t!==r?(h(),n=t):(i=n,n=r),n!==r)for(;n!==r;)s.push(n),n=i,t=Ce(),t!==r?(h(),n=t):(i=n,n=r);else s=r;return s!==r&&(s=or(s)),e=s,e}function Ce(){var e,s,n;if(e=i,s=[],n=L(),n!==r)for(;n!==r;)s.push(n),n=L();else s=r;return s!==r&&(s=pr(s)),e=s,e}function L(){var e,s,n,t;return e=i,s=i,l++,n=be(),n===r&&(f.substr(i,4)===V?(n=V,i+=4):(n=r,l===0&&c(Qe)),n===r&&(n=h())),l--,n===r?s=void 0:(i=s,s=r),s!==r?(n=Mr(),n!==r?(t=z(),t!==r?e=gr(n):(i=e,e=r)):(i=e,e=r)):(i=e,e=r),e}function Mr(){var e,s;if(e=[],s=Ee(),s!==r)for(;s!==r;)e.push(s),s=Ee();else e=r;return e}function Ee(){var e;return e=M(),e===r&&(e=Vr()),e}function M(){var e;return e=_r(),e===r&&(e=Ur(),e===r&&(e=Qr())),e}function N(){var e,s,n;return e=i,s=i,l++,n=R(),l--,n===r?s=void 0:(i=s,s=r),s!==r?(f.substr(i,2)===W?(n=W,i+=2):(n=r,l===0&&c(Ve)),n!==r?(s=[s,n],e=s):(i=e,e=r)):(i=e,e=r),e}function Nr(){var e,s,n,t,a;if(e=i,s=[],n=m(),n===r&&(n=i,t=i,l++,a=N(),l--,a===r?t=void 0:(i=t,t=r),t!==r?(H.test(f.charAt(i))?(a=f.charAt(i),i++):(a=r,l===0&&c(I)),a!==r?n=a:(i=n,n=r)):(i=n,n=r)),n!==r)for(;n!==r;)s.push(n),n=m(),n===r&&(n=i,t=i,l++,a=N(),l--,a===r?t=void 0:(i=t,t=r),t!==r?(H.test(f.charAt(i))?(a=f.charAt(i),i++):(a=r,l===0&&c(I)),a!==r?n=a:(i=n,n=r)):(i=n,n=r));else s=r;return s!==r&&(s=vr(s)),e=s,e}function _r(){var e,s,n,t;return e=i,s=N(),s!==r?(n=Nr(),n!==r?(t=N(),t!==r?e=hr(n):(i=e,e=r)):(i=e,e=r)):(i=e,e=r),e}function _(){var e,s,n;return e=i,s=i,l++,n=R(),l--,n===r?s=void 0:(i=s,s=r),s!==r?(f.substr(i,2)===Y?(n=Y,i+=2):(n=r,l===0&&c(We)),n!==r?(s=[s,n],e=s):(i=e,e=r)):(i=e,e=r),e}function zr(){var e,s,n,t,a;if(e=i,s=[],n=m(),n===r&&(n=i,t=i,l++,a=_(),l--,a===r?t=void 0:(i=t,t=r),t!==r?(H.test(f.charAt(i))?(a=f.charAt(i),i++):(a=r,l===0&&c(I)),a!==r?n=a:(i=n,n=r)):(i=n,n=r)),n!==r)for(;n!==r;)s.push(n),n=m(),n===r&&(n=i,t=i,l++,a=_(),l--,a===r?t=void 0:(i=t,t=r),t!==r?(H.test(f.charAt(i))?(a=f.charAt(i),i++):(a=r,l===0&&c(I)),a!==r?n=a:(i=n,n=r)):(i=n,n=r));else s=r;return s!==r&&(s=$r(s)),e=s,e}function Ur(){var e,s,n,t;return e=i,s=_(),s!==r?(n=zr(),n!==r?(t=_(),t!==r?e=dr(n):(i=e,e=r)):(i=e,e=r)):(i=e,e=r),e}function Xr(){var e,s,n,t,a;return e=i,s=i,l++,n=i,t=R(),t!==r?(f.charCodeAt(i)===94?(a=Z,i++):(a=r,l===0&&c(ue)),a!==r?(t=[t,a],n=t):(i=n,n=r)):(i=n,n=r),l--,n===r?s=void 0:(i=s,s=r),s!==r?(f.charCodeAt(i)===94?(n=Z,i++):(n=r,l===0&&c(ue)),n!==r?(s=[s,n],e=s):(i=e,e=r)):(i=e,e=r),e}function qr(){var e,s,n,t,a;return e=i,s=i,l++,n=i,t=R(),t!==r?(f.charCodeAt(i)===40?(a=ee,i++):(a=r,l===0&&c(ce)),a!==r?(t=[t,a],n=t):(i=n,n=r)):(i=n,n=r),l--,n===r?s=void 0:(i=s,s=r),s!==r?(f.charCodeAt(i)===40?(n=ee,i++):(n=r,l===0&&c(ce)),n!==r?(s=[s,n],e=s):(i=e,e=r)):(i=e,e=r),e}function Gr(){var e,s,n,t,a;return e=i,s=i,l++,n=i,t=R(),t!==r?(f.charCodeAt(i)===41?(a=re,i++):(a=r,l===0&&c(oe)),a!==r?(t=[t,a],n=t):(i=n,n=r)):(i=n,n=r),l--,n===r?s=void 0:(i=s,s=r),s!==r?(f.charCodeAt(i)===41?(n=re,i++):(n=r,l===0&&c(oe)),n!==r?(s=[s,n],e=s):(i=e,e=r)):(i=e,e=r),e}function Jr(){var e,s,n;if(e=i,s=[],n=m(),n===r&&(ie.test(f.charAt(i))?(n=f.charAt(i),i++):(n=r,l===0&&c(pe))),n!==r)for(;n!==r;)s.push(n),n=m(),n===r&&(ie.test(f.charAt(i))?(n=f.charAt(i),i++):(n=r,l===0&&c(pe)));else s=r;return s!==r&&(s=br(s)),e=s,e}function Kr(){var e,s,n;if(e=i,s=[],n=m(),n===r&&(te.test(f.charAt(i))?(n=f.charAt(i),i++):(n=r,l===0&&c(ge))),n!==r)for(;n!==r;)s.push(n),n=m(),n===r&&(te.test(f.charAt(i))?(n=f.charAt(i),i++):(n=r,l===0&&c(ge)));else s=r;return s!==r&&(s=mr(s)),e=s,e}function Qr(){var e,s,n,t,a,x;return e=i,s=Xr(),s!==r?(n=Kr(),n!==r?(t=qr(),t!==r?(a=Jr(),a!==r?(x=Gr(),x!==r?e=Ar(n,a):(i=e,e=r)):(i=e,e=r)):(i=e,e=r)):(i=e,e=r)):(i=e,e=r),e}function Vr(){var e,s,n;if(e=i,s=[],n=m(),n===r&&(n=Fe()),n!==r)for(;n!==r;)s.push(n),n=m(),n===r&&(n=Fe());else s=r;return s!==r&&(s=xr(s)),e=s,e}function Fe(){var e,s,n;return e=i,s=i,l++,n=M(),n===r&&(n=R(),n===r&&(n=h())),l--,n===r?s=void 0:(i=s,s=r),s!==r?(f.length>i?(n=f.charAt(i),i++):(n=r,l===0&&c(q)),n!==r?e=n:(i=e,e=r)):(i=e,e=r),e}function m(){var e,s,n;return e=i,s=R(),s!==r?(_e.test(f.charAt(i))?(n=f.charAt(i),i++):(n=r,l===0&&c(Ye)),n!==r?e=n:(i=e,e=r)):(i=e,e=r),e}function R(){var e;return f.charCodeAt(i)===92?(e=Ne,i++):(e=r,l===0&&c(Ze)),e}function h(){var e;return f.substr(i,2)===ne?(e=ne,i+=2):(e=r,l===0&&c(er)),e===r&&(ze.test(f.charAt(i))?(e=f.charAt(i),i++):(e=r,l===0&&c(rr))),e}function y(){var e;return Ue.test(f.charAt(i))?(e=f.charAt(i),i++):(e=r,l===0&&c(nr)),e}function Wr(){var e,s;return e=i,l++,f.length>i?(s=f.charAt(i),i++):(s=r,l===0&&c(q)),l--,s===r?e=void 0:(i=e,e=r),e}function z(){var e;return e=h(),e===r&&(e=Wr()),e}if(O=A(),O!==r&&i===f.length)return O;throw O!==r&&i<f.length&&c(wr()),Cr(G,b<f.length?f.charAt(b):null,b<f.length?he(b,b+1):he(b,b))}const Me={parse:Le};w.Lazri=Me,w.htmlTransform=T,Object.defineProperties(w,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
